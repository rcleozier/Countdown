# Billing vs Subscriptions - Architecture Explanation

## Overview

Your app currently has **two** subscription/billing systems:

### 1. `src/subscriptions/` (OLD - Legacy System)
- **Status**: Legacy implementation, being phased out
- **Files**:
  - `SubscriptionProvider.jsx` - Old provider using expo-in-app-purchases directly
  - `useSubscription.js` - Old hook
  - `gating.js` - Access control functions
  - `config.js` - Product IDs and free program config

**Characteristics**:
- Direct integration with `expo-in-app-purchases`
- Less structured, harder to extend
- Mixed concerns (store logic + state management)
- No platform abstraction layer

### 2. `src/billing/` (NEW - Production System)
- **Status**: Active, production-ready implementation
- **Files**:
  - `BillingProvider.jsx` - New provider with clean architecture
  - `useEntitlements.js` - New hook + access control helpers
  - `storeAdapters/expoStoreAdapter.js` - Platform abstraction layer
  - `BillingDebugScreen.jsx` - Testing/debugging tool
  - `types.js` - Type definitions

**Characteristics**:
- **Platform abstraction**: Easy to swap `expo-in-app-purchases` for `react-native-iap` or RevenueCat
- **Clean separation**: Store adapter pattern separates platform-specific code
- **Better state management**: More robust entitlement caching and refresh logic
- **Production features**: Debug screen, better error handling, proper disclosures
- **Android-ready**: Structure supports Android with minimal changes

## Current State

**App.js** is currently using `BillingProvider` (the new system):
```javascript
import { BillingProvider } from "./src/billing/BillingProvider";
// ...
<BillingProvider>
  <NavigationContainer>...</NavigationContainer>
</BillingProvider>
```

**Screens** should be using the new system:
- `TrainingScreen.js` - ✅ Updated to use `useEntitlements`
- `ModuleDetailScreen.js` - ⚠️ May still have some old references
- `PaywallModal.jsx` - ✅ New component using `useEntitlements`

## Migration Status

### ✅ Completed
- New `BillingProvider` created
- New `PaywallModal` component
- `TrainingScreen` updated
- App.js wrapped with `BillingProvider`

### ⚠️ Needs Cleanup
- `ModuleDetailScreen.js` may still reference old `SubscriptionPrompt`
- Old `src/subscriptions/` folder can be removed after confirming all screens use new system

## Recommendation

1. **Keep using `src/billing/`** - This is your production system
2. **Remove `src/subscriptions/`** after verifying:
   - All screens use `useEntitlements` from `src/billing/`
   - No remaining imports of `SubscriptionProvider` or `useSubscription` from old folder
   - `SubscriptionPrompt` component is replaced by `PaywallModal`

## Key Differences

| Feature | Old (`subscriptions/`) | New (`billing/`) |
|---------|----------------------|------------------|
| Platform Support | iOS only, hardcoded | iOS + Android-ready abstraction |
| Store Library | Direct expo-in-app-purchases | Adapter pattern (swappable) |
| Error Handling | Basic | Comprehensive with states |
| Caching | Basic | Robust with fallbacks |
| Testing Tools | None | Debug screen included |
| Code Organization | Mixed concerns | Clean separation |
| Paywall | `SubscriptionPrompt` | `PaywallModal` (better UX) |

## Next Steps

1. Verify all screens use `useEntitlements` from `src/billing/`
2. Remove old `src/subscriptions/` folder
3. Update any remaining `SubscriptionPrompt` references to `PaywallModal`

